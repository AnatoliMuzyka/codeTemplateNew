<!DOCTYPE html>
<html>
  <head>
    <title>СКД программное заполнение параметров</title>
  </head>
  <body>
	<h1>СКД программное заполнение параметров</h1>
    <p>
		<code>
			<pre>
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	если ЗначениеЗаполнено(датаНачала) тогда
		ПараметрКомпоновки 			= Новый ПараметрКомпоновкиДанных("ПериодНачало");
		ПараметрСКД 				= Отчет.КомпоновщикНастроек.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(ПараметрКомпоновки);
		ПараметрСКД.Значение 		= датаНачала;
		ПараметрСКД.Использование 	= Истина;
		Если ЗначениеЗаполнено(ПараметрСКД.ИдентификаторПользовательскойНастройки) Тогда
			
			ПользовательскийПараметр = Отчет.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(
			ПараметрСКД.ИдентификаторПользовательскойНастройки);
			Если ТипЗнч(ПользовательскийПараметр) = Тип("ЗначениеПараметраНастроекКомпоновкиДанных") Тогда
				ПользовательскийПараметр.Значение = ПараметрСКД.Значение;
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	если ЗначениеЗаполнено(ДатаКонца) тогда
		ПараметрКомпоновки 			= Новый ПараметрКомпоновкиДанных("ПериодКонец");
		ПараметрСКД 				= Отчет.КомпоновщикНастроек.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(ПараметрКомпоновки);
		ПараметрСКД.Значение		= ДатаКонца;
		ПараметрСКД.Использование 	= Истина;
		
		Если ЗначениеЗаполнено(ПараметрСКД.ИдентификаторПользовательскойНастройки) Тогда
			
			ПользовательскийПараметр = Отчет.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(
			ПараметрСКД.ИдентификаторПользовательскойНастройки);
			Если ТипЗнч(ПользовательскийПараметр) = Тип("ЗначениеПараметраНастроекКомпоновкиДанных") Тогда
				ПользовательскийПараметр.Значение = ПараметрСКД.Значение;
			КонецЕсли;
			
		КонецЕсли;
	конецЕсли;
	
	если ЗначениеЗаполнено(Контрагент) или ЗначениеЗаполнено(Номенклатура) тогда
		значениеКонтрагент = Контрагент;
		значениеНоменклатура = Номенклатура;
		//Ищем пользовательский отбор
		для каждого элементОтбора из Отчет.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы цикл
			если типЗнч(элементОтбора) = тип("ЭлементОтбораКомпоновкиДанных") тогда
//				если типЗнч(элементОтбора.ПравоеЗначение) = тип("СправочникСсылка.Контрагенты") тогда
					если ЗначениеЗаполнено(значениеКонтрагент) тогда
						 элементОтбора.ПравоеЗначение =  Контрагент;
						элементОтбора.Использование 	= истина;
						значениеКонтрагент = Неопределено;
						продолжить;
					//иначе
					//	элементОтбора.Использование 	= ложь;
					конецЕсли;
//				конецЕсли;
//				если типЗнч(элементОтбора.ПравоеЗначение) = тип("СправочникСсылка.Номенклатура") тогда
					если ЗначениеЗаполнено(значениеНоменклатура) тогда
						элементОтбора.ПравоеЗначение =  Номенклатура;
						элементОтбора.Использование 	= истина;
						значениеНоменклатура = Неопределено;
						продолжить;
					//иначе
					//	элементОтбора.Использование 	= ложь;
					конецЕсли;
//				конецЕсли;
			конецЕсли;
		конецЦикла;
	конецЕсли;
	
	ОбновитьОтображениеДанных();
	ЭтаФорма.ВариантМодифицирован = Ложь; 
	ЭтаФорма.СкомпоноватьРезультат();	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	НайденноеЗначение = "";
	ЭтаФорма.Параметры.Свойство("ОбъектыНазначения", НайденноеЗначение);
	параметрыДляПередачиВОтчет = "";
	ЭтаФорма.Параметры.Свойство("параметрыДляПередачиВОтчет", параметрыДляПередачиВОтчет);
	если ЗначениеЗаполнено(параметрыДляПередачиВОтчет) тогда
		реквизитыДляЗаполненияВПараметры = параметрыДляПередачиВОтчет.реквизитыДляЗаполненияВПараметры;
		датаНачала		= ДобавитьМесяц(НачалоДня(реквизитыДляЗаполненияВПараметры.дата), -12);
		ДатаКонца		= КонецДня(реквизитыДляЗаполненияВПараметры.дата);
		Контрагент		= реквизитыДляЗаполненияВПараметры.контрагентСсылка.ссылка;
		Номенклатура	= реквизитыДляЗаполненияВПараметры.Номенклатура.ссылка;
	иначе	
		датаНачала		= ДобавитьМесяц(НачалоДня(ТекущаяДата()), -12);
		ДатаКонца		= КонецДня(ТекущаяДата());
	конецЕсли;
КонецПроцедуры
			</pre>
		</code>
	</p>
 </body>
</html>